___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Exoclick by Stape",
  "categories": [
    "AFFILIATE_MARKETING",
    "ADVERTISING",
    "CONVERSIONS"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "stape.io",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Exoclick server-to-server (S2S) conversion tracking.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "conversionGroup",
    "subParams": [
      {
        "type": "TEXT",
        "name": "conversionId",
        "displayName": "Goal ID",
        "simpleValueType": true,
        "help": "The Goal ID. It can be found on your \u003ca href\u003d\"https://admin.exoclick.com/panel/advertiser/conversions\"\u003eExoclick Conversion Tracking\u003c/a\u003e tab in the column named \"\u003cb\u003eID\u003c/b\u003e\".",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "clickId",
        "displayName": "Click ID",
        "simpleValueType": true,
        "notSetText": "",
        "help": "Your defined ad click ID. It must carry the value of your \u003cb\u003e{conversion_tracking}\u003c/b\u003e ad destination parameter. You can find an example of this value while editing your campaign Ads. Just click on \"Test Variation\" icon present in one of your listed ads. You will notice that the link takes you to the final destination, with the URL decorated with your click-ID. Check \u003ca href\u003d\"https://docs.exoclick.com/docs/conversion-tracking/\"\u003e documentation \u003c/a\u003e for more information.",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "RADIO",
        "name": "conversionValue",
        "displayName": "Conversion Value",
        "radioItems": [
          {
            "value": "fixed",
            "displayValue": "Fixed Value",
            "help": "Select this option if your Goal was created with a fixed value in the platform. You can find this at your Conversion Tracking tab in your Exoclick account."
          },
          {
            "value": "dynamic",
            "displayValue": "Dynamic Value",
            "subParams": [
              {
                "type": "TEXT",
                "name": "value",
                "displayName": "Conversion Value",
                "simpleValueType": true,
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  }
                ]
              }
            ],
            "help": "Select this option if your Goal has dynamic values and add your value variable on the field below"
          }
        ],
        "simpleValueType": true,
        "subParams": []
      },
      {
        "type": "CHECKBOX",
        "name": "useOptimisticScenario",
        "checkboxText": "Use Optimistic Scenario",
        "simpleValueType": true,
        "help": "The tag will call gtmOnSuccess() without waiting for a response from the API. This will speed up sGTM response time however your tag will always return the status fired successfully even in case it is not.",
        "defaultValue": false
      }
    ],
    "groupStyle": "ZIPPY_OPEN",
    "displayName": "Conversion Data"
  },
  {
    "type": "GROUP",
    "name": "tagExecutionConsentSettingsGroup",
    "displayName": "Tag Execution Consent Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "RADIO",
        "name": "adStorageConsent",
        "radioItems": [
          {
            "value": "optional",
            "displayValue": "Send data always"
          },
          {
            "value": "required",
            "displayValue": "Send data in case marketing consent given",
            "help": "Aborts the tag execution if marketing consent (\u003ci\u003ead_storage\u003c/i\u003e Google Consent Mode or Stape\u0027s Data Tag parameter) is not given."
          }
        ],
        "simpleValueType": true,
        "defaultValue": "optional"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "logsGroup",
    "displayName": "Logs Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "RADIO",
        "name": "logType",
        "radioItems": [
          {
            "value": "no",
            "displayValue": "Do not log"
          },
          {
            "value": "debug",
            "displayValue": "Log to console during debug and preview"
          },
          {
            "value": "always",
            "displayValue": "Always log to console"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "debug"
      }
    ]
  },
  {
    "displayName": "BigQuery Logs Settings",
    "name": "bigQueryLogsGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "RADIO",
        "name": "bigQueryLogType",
        "radioItems": [
          {
            "value": "no",
            "displayValue": "Do not log to BigQuery"
          },
          {
            "value": "always",
            "displayValue": "Log to BigQuery"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "no"
      },
      {
        "type": "GROUP",
        "name": "logsBigQueryConfigGroup",
        "groupStyle": "NO_ZIPPY",
        "subParams": [
          {
            "type": "TEXT",
            "name": "logBigQueryProjectId",
            "displayName": "BigQuery Project ID",
            "simpleValueType": true,
            "help": "Optional.  \u003cbr/\u003e\u003cbr/\u003e  If omitted, it will be retrieved from the environment variable \u003cI\u003eGOOGLE_CLOUD_PROJECT\u003c/i\u003e where the server container is running. If the server container is running on Google Cloud, \u003cI\u003eGOOGLE_CLOUD_PROJECT\u003c/i\u003e will already be set to the Google Cloud project\u0027s ID."
          },
          {
            "type": "TEXT",
            "name": "logBigQueryDatasetId",
            "displayName": "BigQuery Dataset ID",
            "simpleValueType": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          },
          {
            "type": "TEXT",
            "name": "logBigQueryTableId",
            "displayName": "BigQuery Table ID",
            "simpleValueType": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "enablingConditions": [
          {
            "paramName": "bigQueryLogType",
            "paramValue": "always",
            "type": "EQUALS"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const BigQuery = require('BigQuery');
const encodeUriComponent = require('encodeUriComponent');
const getAllEventData = require('getAllEventData');
const getContainerVersion = require('getContainerVersion');
const getRequestHeader = require('getRequestHeader');
const getTimestampMillis = require('getTimestampMillis');
const JSON = require('JSON');
const logToConsole = require('logToConsole');
const makeString = require('makeString');
const sendHttpRequest = require('sendHttpRequest');

/*==============================================================================
==============================================================================*/

const eventData = getAllEventData();

if(checkGuardClauses(data,eventData)) return;

sendConversion(data);

if (data.useOptimisticScenario) {
  return data.gtmOnSuccess();
}

/*==============================================================================
  Vendor related functions
==============================================================================*/

function sendConversion(data) {
  const goal = data.conversionId;
  const clickId = data.clickId;
  let requestUrl = 'https://s.magsrv.com/tag.php?' + 'goal=' + enc(goal) + '&tag=' + enc(clickId);

  const requestOptions = {
    method: "GET"
  };
  
  if(data.conversionValue === 'dynamic') requestUrl += '&value=' + enc(makeString(data.value));
  

  log({
    Name: 'Exoclick',
    Type: 'Request',
    EventName: 'Conversion',
    RequestMethod: requestOptions.method,
    RequestUrl: requestUrl,
    RequestBody: ''
  });

  return sendHttpRequest(requestUrl, requestOptions)
  .then(response => {
       log({
        Name: 'Exoclick',
        Type: 'Response',
        EventName: 'Conversion',
        ResponseStatusCode: response.statusCode,
        ResponseHeaders: response.headers,
        ResponseBody: response.body
      });  
    
    if(response.body.match('ERROR')) {
      return data.gtmOnFailure();
    }
    else {
      return data.gtmOnSuccess();
    }
  })
  .catch(error => {
       log({
        Name: 'Exoclick',
        Type: 'Message',
        EventName: 'Conversion',
        Message: 'API call failed or timed out',
        Reason: error
      });
    return data.gtmOnFailure();
  });
}

/*==============================================================================
  Helpers
==============================================================================*/

function checkGuardClauses(data,eventData) {
  const url = eventData.page_location || getRequestHeader('referer');

  if (!isConsentGivenOrNotRequired(data, eventData)) {
    data.gtmOnSuccess();
    return true;
  }

  if (url && url.lastIndexOf('https://gtm-msr.appspot.com/', 0) === 0) {
    data.gtmOnSuccess();
    return true;
  }
}

function enc(data) {
  if (data === undefined || data === null) data = '';
  return encodeUriComponent(makeString(data));
}

function isConsentGivenOrNotRequired(data, eventData) {
  if (data.adStorageConsent !== 'required') return true;
  if (eventData.consent_state) return !!eventData.consent_state.ad_storage;
  const xGaGcs = eventData['x-ga-gcs'] || ''; // x-ga-gcs is a string like "G110"
  return xGaGcs[2] === '1';
}

function log(rawDataToLog) {
  const logDestinationsHandlers = {};
  if (determinateIsLoggingEnabled()) logDestinationsHandlers.console = logConsole;
  if (determinateIsLoggingEnabledForBigQuery()) logDestinationsHandlers.bigQuery = logToBigQuery;

  rawDataToLog.TraceId = getRequestHeader('trace-id');

  const keyMappings = {
    // No transformation for Console is needed.
    bigQuery: {
      Name: 'tag_name',
      Type: 'type',
      TraceId: 'trace_id',
      EventName: 'event_name',
      RequestMethod: 'request_method',
      RequestUrl: 'request_url',
      RequestBody: 'request_body',
      ResponseStatusCode: 'response_status_code',
      ResponseHeaders: 'response_headers',
      ResponseBody: 'response_body'
    }
  };

  for (const logDestination in logDestinationsHandlers) {
    const handler = logDestinationsHandlers[logDestination];
    if (!handler) continue;

    const mapping = keyMappings[logDestination];
    const dataToLog = mapping ? {} : rawDataToLog;

    if (mapping) {
      for (const key in rawDataToLog) {
        const mappedKey = mapping[key] || key;
        dataToLog[mappedKey] = rawDataToLog[key];
      }
    }

    handler(dataToLog);
  }
}

function logConsole(dataToLog) {
  logToConsole(JSON.stringify(dataToLog));
}

function logToBigQuery(dataToLog) {
  const connectionInfo = {
    projectId: data.logBigQueryProjectId,
    datasetId: data.logBigQueryDatasetId,
    tableId: data.logBigQueryTableId
  };

  dataToLog.timestamp = getTimestampMillis();

  ['request_body', 'response_headers', 'response_body'].forEach((p) => {
    dataToLog[p] = JSON.stringify(dataToLog[p]);
  });

  BigQuery.insert(connectionInfo, [dataToLog], { ignoreUnknownValues: true });
}

function determinateIsLoggingEnabled() {
  const containerVersion = getContainerVersion();
  const isDebug = !!(
    containerVersion &&
    (containerVersion.debugMode || containerVersion.previewMode)
  );

  if (!data.logType) {
    return isDebug;
  }

  if (data.logType === 'no') {
    return false;
  }

  if (data.logType === 'debug') {
    return isDebug;
  }

  return data.logType === 'always';
}

function determinateIsLoggingEnabledForBigQuery() {
  if (data.bigQueryLogType === 'no') return false;
  return data.bigQueryLogType === 'always';
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headerWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "trace-id"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "referer"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "bodyAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://s.magsrv.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_bigquery",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedTables",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "projectId"
                  },
                  {
                    "type": 1,
                    "string": "datasetId"
                  },
                  {
                    "type": 1,
                    "string": "tableId"
                  },
                  {
                    "type": 1,
                    "string": "operation"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: '[Page View] Tag is not executed when Tag Execution Consent is Denied'
  code: |-
    setGetAllEventData({
      'x-ga-gcs': 'G100'
    });
    setAllMockDataByEventType('pageView', {
      adStorageConsent: 'required'
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
    assertApi('getCookieValues').wasNotCalled();
    assertApi('setCookie').wasNotCalled();
    assertApi('sendHttpRequest').wasNotCalled();
- name: '[Page View] Click ID cookie is NOT set if URL doesn''t contain it'
  code: |-
    setAllMockDataByEventType('pageView');

    mock('getAllEventData', {
      page_location: 'https://example.com/'
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
    assertApi('setCookie').wasNotCalled();
- name: '[Page View] Click ID cookie is set if URL contains it'
  code: |-
    setAllMockDataByEventType('pageView');

    const expectedCookieOptions = {
      domain: 'auto',
      samesite: 'none',
      path: '/',
      secure: true,
      httpOnly: false,
      'max-age': 2592000
    };

    mock('getAllEventData', {
      page_location: 'https://example.com/?utm_source=effinity&eff_cpt=eff_cptValue&eff_sub1=eff_sub1Value&eff_sub2=eff_sub2Value&eff_pid=eff_pidValue&eff_pcid=eff_pcidValue&eff_pcuid=eff_pcuidValue&eff_pr1=eff_pr1Value'
    });

    mock('setCookie', () => {
      const cookieName = arguments[0];
      const cookieValue = arguments[1];
      const cookieOptions = arguments[2];
      const noEncode = arguments[3];
      assertThat(cookieName).isEqualTo('eff_cid');
      assertThat(JSON.parse(cookieValue)).isEqualTo({
        id_compteur: 'eff_cptValue',
        effi_id: 'eff_sub1Value',
        effi_id2: 'eff_sub2Value',
        prod_id: 'eff_pidValue',
        effi_pcid: 'eff_pcidValue',
        effi_pcuid: 'eff_pcuidValue',
        effi_param1: 'eff_pr1Value'
      });
      assertThat(cookieOptions).isEqualTo(expectedCookieOptions);
      assertThat(noEncode).isFalse();
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
- name: '[Page View] Click ID Cookie settings are overwritten'
  code: |-
    const cookieDomain = 'example.com';
    const cookieHttpOnly = false;
    const maxAgeDays = 1;

    const expectedOverwrittenCookieOptions = {
      domain: cookieDomain,
      samesite: 'lax',
      path: '/',
      secure: true,
      httpOnly: cookieHttpOnly,
      'max-age': 60 * 60 * 24 * maxAgeDays
    };

    setAllMockDataByEventType('pageView', {
      cookieDomain: cookieDomain,
      cookieSameSite: 'lax',
      cookieExpiration: maxAgeDays,
      cookieHttpOnly: cookieHttpOnly
    });

    mock('getAllEventData', {
      page_location: 'https://example.com/?utm_source=effinity&eff_cpt=eff_cptValue&eff_sub1=eff_sub1Value&eff_sub2=eff_sub2Value&eff_pid=eff_pidValue&eff_pcid=eff_pcidValue&eff_pcuid=eff_pcuidValue&eff_pr1=eff_pr1Value'});

    mock('setCookie', () => {
      const cookieName = arguments[0];
      const cookieValue = arguments[1];
      const cookieOptions = arguments[2];
      const noEncode = arguments[3];
      assertThat(cookieName).isEqualTo('eff_cid');
      assertThat(JSON.parse(cookieValue)).isEqualTo({
        id_compteur: 'eff_cptValue',
        effi_id: 'eff_sub1Value',
        effi_id2: 'eff_sub2Value',
        prod_id: 'eff_pidValue',
        effi_pcid: 'eff_pcidValue',
        effi_pcuid: 'eff_pcuidValue',
        effi_param1: 'eff_pr1Value'
      });
      assertThat(cookieOptions).isEqualTo(expectedOverwrittenCookieOptions);
      assertThat(noEncode).isFalse();
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
- name: '[Conversion] Tag is not executed when Tag Execution Consent is Denied'
  code: |-
    setGetAllEventData({
      'x-ga-gcs': 'G100'
    });
    setAllMockDataByEventType('conversion_sale', {
      adStorageConsent: 'required'
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
    assertApi('getCookieValues').wasNotCalled();
    assertApi('setCookie').wasNotCalled();
    assertApi('sendHttpRequest').wasNotCalled();
- name: '[Conversion Lead] Request is not sent if required parameters are missing'
  code: "const originalMockData = setAllMockDataByEventType('conversion_lead');\n\n\
    [\n  { consentPerformance: undefined },\n  { effinityId: undefined },\n  { idCompteur:\
    \ undefined },\n  { orderOrLeadId: undefined }\n].forEach((scenario) => {\n  const\
    \ copyMockData = JSON.parse(JSON.stringify(originalMockData));\n  mergeObj(copyMockData,\
    \ scenario);\n  \n  runCode(copyMockData);\n  \n  assertApi('sendHttpRequest').wasNotCalled();\n\
    \  assertApi('gtmOnSuccess').wasNotCalled();\n  assertApi('gtmOnFailure').wasCalled();\n\
    });\n"
- name: '[Conversion Sale] Request is not sent if required parameters are missing'
  code: "const originalMockData = setAllMockDataByEventType('conversion_sale');\n\n\
    [\n  { consentPerformance: undefined },\n  { effinityId: undefined },\n  { idCompteur:\
    \ undefined },\n  { orderOrLeadId: undefined },\n  { currency: undefined },\n\
    \  { value: undefined },\n  { voucher: undefined }\n].forEach((scenario) => {\n\
    \  const copyMockData = JSON.parse(JSON.stringify(originalMockData));\n  mergeObj(copyMockData,\
    \ scenario);\n  \n  runCode(copyMockData);\n  \n  assertApi('sendHttpRequest').wasNotCalled();\n\
    \  assertApi('gtmOnSuccess').wasNotCalled();\n  assertApi('gtmOnFailure').wasCalled();\n\
    });\n"
- name: '[Conversion Lead] Request Base URL is correctly built'
  code: |-
    setAllMockDataByEventType('conversion_lead');

    mock('sendHttpRequest', (requestUrl, callback, requestOptions, requestBody) => {
      const parsedUrl = parseUrl(requestUrl);
      assertThat(parsedUrl.origin + parsedUrl.pathname).isEqualTo('https://track.effiliation.com/servlet/effi.leadmobile');
      callback(200);
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
- name: '[Conversion Sale] Request Base URL is correctly built'
  code: |-
    setAllMockDataByEventType('conversion_sale');

    mock('sendHttpRequest', (requestUrl, callback, requestOptions, requestBody) => {
      const parsedUrl = parseUrl(requestUrl);
      assertThat(parsedUrl.origin + parsedUrl.pathname).isEqualTo('https://track.effiliation.com/servlet/effi.revenuemobile');
      callback(200);
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
- name: '[Conversion] Request Options is correctly built'
  code: |-
    setAllMockDataByEventType('conversion_sale');

    mock('sendHttpRequest', (requestUrl, callback, requestOptions, requestBody) => {
      assertThat(requestOptions).isEqualTo({
        method: 'GET'
      });
      callback(200);
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
- name: '[Conversion Lead] [Data from UI fields] Request is successfully built and
    sent'
  code: |-
    setAllMockDataByEventType('conversion_lead', {
      autoMapData: false
    });

    mock('sendHttpRequest', (requestUrl, callback, requestOptions, requestBody) => {
      assertThat(requestUrl).isEqualTo('https://track.effiliation.com/servlet/effi.leadmobile?id=effinityId&origin=stape_s2s&ref=leadId&consent_performance=1&attrib=2&date=2025-12-31&ref2=123&id_compteur=eff_cpt&effi_id=eff_sub1&effi_id2=eff_sub2&prod_id=eff_pid&effi_pcid=eff_pcid&effi_pcuid=eff_pcuid&effi_param1=eff_pr1');
      callback(200);
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
- name: '[Conversion Lead] [Data from UI fields fallbacks] Request is successfully
    built and sent'
  code: |-
    setAllMockDataByEventType('conversion_lead', {
      autoMapData: true
    });

    ['orderOrLeadId', 'idCompteur', 'effiId', 'effiId2', 'prodId', 'effiPcid', 'effiPcuid', 'effiParam1'].forEach(p => Object.delete(mockData, p));

    setGetAllEventData();

    mock('getCookieValues', (cookieName) => {
      if (cookieName === 'eff_cid') {
        return [
          JSON.stringify({
            id_compteur: 'eff_cpt_from_cookie',
            effi_id: 'eff_sub1_from_cookie',
            effi_id2: 'eff_sub2_from_cookie',
            prod_id: 'eff_pid_from_cookie',
            effi_pcid: 'eff_pcid_from_cookie',
            effi_pcuid: 'eff_pcuid_from_cookie',
            effi_param1: 'eff_pr1_from_cookie'
          })
        ];
      }
      return [];
    });

    mock('sendHttpRequest', (requestUrl, callback, requestOptions, requestBody) => {
      assertThat(requestUrl).isEqualTo('https://track.effiliation.com/servlet/effi.leadmobile?id=effinityId&origin=stape_s2s&ref=transactionId&consent_performance=1&attrib=2&date=2025-12-31&ref2=123&id_compteur=eff_cpt_from_cookie&effi_id=eff_sub1_from_cookie&effi_id2=eff_sub2_from_cookie&prod_id=eff_pid_from_cookie&effi_pcid=eff_pcid_from_cookie&effi_pcuid=eff_pcuid_from_cookie&effi_param1=eff_pr1_from_cookie');
      callback(200);
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
- name: '[Conversion Sale] [Data from UI fields] Request is successfully built and
    sent'
  code: |-
    setAllMockDataByEventType('conversion_sale', {
      autoMapData: false
    });

    mock('sendHttpRequest', (requestUrl, callback, requestOptions, requestBody) => {
      assertThat(requestUrl).isEqualTo("https://track.effiliation.com/servlet/effi.revenuemobile?id=effinityId&origin=stape_s2s&ref=orderId&montant=value&monnaie=currency&voucher=voucher&payment=paymentype&newcustomer=1&cart_detail=%5B%7B%22id%22%3A%22SKU_12345%22%2C%22name%22%3A%22Stan%20and%20Friends%20Tee%22%2C%22price%22%3A10.01%2C%22quantity%22%3A3%7D%2C%7B%22id%22%3A%22SKU_12346%22%2C%22name%22%3A%22Google%20Grey%20Women's%20(Tee)%22%2C%22price%22%3A21.01%2C%22quantity%22%3A2%7D%5D&consent_performance=1&attrib=2&date=2025-12-31&ref2=123&id_compteur=eff_cpt&effi_id=eff_sub1&effi_id2=eff_sub2&prod_id=eff_pid&effi_pcid=eff_pcid&effi_pcuid=eff_pcuid&effi_param1=eff_pr1");
      callback(200);
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
- name: '[Conversion Sale] [Data from UI fields fallbacks] Request is successfully
    built and sent'
  code: |-
    setAllMockDataByEventType('conversion_sale', {
      autoMapData: true
    });

    ['orderOrLeadId', 'value', 'currency', 'voucher', 'paymentType', 'newCustomer', 'cart', 'idCompteur', 'effiId', 'effiId2', 'prodId', 'effiPcid', 'effiPcuid', 'effiParam1'].forEach(p => Object.delete(mockData, p));

    setGetAllEventData();

    mock('getCookieValues', (cookieName) => {
      if (cookieName === 'eff_cid') {
        return [
          JSON.stringify({
            id_compteur: 'eff_cpt_from_cookie',
            effi_id: 'eff_sub1_from_cookie',
            effi_id2: 'eff_sub2_from_cookie',
            prod_id: 'eff_pid_from_cookie',
            effi_pcid: 'eff_pcid_from_cookie',
            effi_pcuid: 'eff_pcuid_from_cookie',
            effi_param1: 'eff_pr1_from_cookie'
          })
        ];
      }
      return [];
    });

    mock('sendHttpRequest', (requestUrl, callback, requestOptions, requestBody) => {
      assertThat(requestUrl).isEqualTo("https://track.effiliation.com/servlet/effi.revenuemobile?id=effinityId&origin=stape_s2s&ref=transactionId&montant=123.45&monnaie=BRL&voucher=coupon&payment=card&newcustomer=1&cart_detail=%5B%7B%22id%22%3A%22SKU_12345%22%2C%22name%22%3A%22Stan%20and%20Friends%20Tee%22%2C%22price%22%3A10.01%2C%22quantity%22%3A3%7D%2C%7B%22id%22%3A%22SKU_12346%22%2C%22name%22%3A%22Google%20Grey%20Women's%20(Tee)%22%2C%22price%22%3A21.01%2C%22quantity%22%3A2%7D%5D&consent_performance=1&attrib=2&date=2025-12-31&ref2=123&id_compteur=eff_cpt_from_cookie&effi_id=eff_sub1_from_cookie&effi_id2=eff_sub2_from_cookie&prod_id=eff_pid_from_cookie&effi_pcid=eff_pcid_from_cookie&effi_pcuid=eff_pcuid_from_cookie&effi_param1=eff_pr1_from_cookie");
      callback(200);
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasCalled();
    assertApi('gtmOnFailure').wasNotCalled();
- name: '[Conversion] Failure handler is called if response status code is outside
    success range'
  code: |-
    setAllMockDataByEventType('conversion_sale');

    mock('sendHttpRequest', (requestUrl, callback, requestOptions, requestBody) => {
      callback(500);
    });

    runCode(mockData);

    assertApi('gtmOnSuccess').wasNotCalled();
    assertApi('gtmOnFailure').wasCalled();
- name: '[Logs] Should log to console'
  code: "const originalMockData = setAllMockDataByEventType('conversion_sale');\n\n\
    [\n  // if the 'Always log to console' option is selected\n  { mockData: { logType:\
    \ 'always' }, expectedDebugMode: true },\n  // if the 'Log during debug and preview'\
    \ option is selected AND is on preview mode\n  { mockData: { logType: 'debug'\
    \ }, expectedDebugMode: true },\n].forEach(scenario => {\n  const copyMockData\
    \ = JSON.parse(JSON.stringify(originalMockData));\n  mergeObj(copyMockData, scenario.mockData);\n\
    \  \n  mock('getContainerVersion', () => {\n    return {\n      debugMode: scenario.expectedDebugMode\n\
    \    };\n  }); \n  \n  mock('logToConsole', (logData) => {\n    const parsedLogData\
    \ = JSON.parse(logData);\n    requiredConsoleKeys.forEach(p => assertThat(parsedLogData[p]).isDefined());\n\
    \  });\n  \n  runCode(copyMockData);\n  \n  assertApi('logToConsole').wasCalled();\n\
    \  assertApi('gtmOnSuccess').wasCalled();\n  assertApi('gtmOnFailure').wasNotCalled();\n\
    });"
- name: '[Logs] Should NOT log to console'
  code: "const originalMockData = setAllMockDataByEventType('conversion_sale');\n\n\
    [\n  // if the 'Log during debug and preview' option is selected AND is NOT on\
    \ preview mode\n  { mockData: { logType: 'debug' }, expectedDebugMode: false },\n\
    \  // if the 'Do not log' option is selected\n  { mockData: { logType: 'no' },\
    \ expectedDebugMode: undefined },\n].forEach(scenario => {\n  const copyMockData\
    \ = JSON.parse(JSON.stringify(originalMockData));\n  mergeObj(copyMockData, scenario.mockData);\n\
    \  \n  mock('getContainerVersion', () => {\n    return {\n      debugMode: scenario.expectedDebugMode\n\
    \    };\n  });\n  \n  runCode(copyMockData);\n\n  assertApi('logToConsole').wasNotCalled();\n\
    \  assertApi('gtmOnSuccess').wasCalled();\n  assertApi('gtmOnFailure').wasNotCalled();\n\
    });"
- name: '[Logs] Should log to BQ, if the ''Log to BigQuery'' option is selected'
  code: "setAllMockDataByEventType('conversion_sale');\n\nmockData.bigQueryLogType\
    \ = 'always';\n\nmockObject('BigQuery', {\n  insert: (connectionInfo, rows, options)\
    \ => { \n    assertThat(connectionInfo).isDefined();\n    assertThat(rows).isArray();\n\
    \    assertThat(rows).hasLength(1);\n    requiredBqKeys.forEach(p => assertThat(rows[0][p]).isDefined());\n\
    \    assertThat(options).isEqualTo(expectedBqOptions);\n    return Promise.create((resolve,\
    \ reject) => {\n      resolve();\n    });\n  }\n});\n\nrunCode(mockData);\n\n\
    assertApi('gtmOnSuccess').wasCalled();\nassertApi('gtmOnFailure').wasNotCalled();\n"
- name: '[Logs] Should NOT log to BQ, if the ''Do not log to BigQuery'' option is
    selected'
  code: "setAllMockDataByEventType('conversion_sale');\n\nmockData.bigQueryLogType\
    \ = 'no';\n\n// assertApi doesn't work for 'BigQuery.insert()'.\n// Ref: https://gtm-gear.com/posts/gtm-templates-testing/\n\
    mockObject('BigQuery', {\n  insert: (connectionInfo, rows, options) => { \n  \
    \  fail('BigQuery.insert should not have been called.');\n    return Promise.create((resolve,\
    \ reject) => {\n      resolve();\n    });\n  }\n});\n\nrunCode(mockData);\n\n\
    assertApi('gtmOnSuccess').wasCalled();\nassertApi('gtmOnFailure').wasNotCalled();"
setup: "const JSON = require('JSON');\nconst Promise = require('Promise');\nconst\
  \ parseUrl = require('parseUrl');\nconst Object = require('Object');\n\nfunction\
  \ mergeObj(target, source) {\n  for (const key in source) {\n    if (source.hasOwnProperty(key))\
  \ target[key] = source[key];\n  }\n  return target;\n}\n\nconst setGetAllEventData\
  \ = (objToBeMerged) => {\n  mock('getAllEventData', mergeObj({\n    'x-ga-protocol_version':\
  \ '2',\n    'x-ga-measurement_id': 'G-123ABC',\n    'x-ga-gtm_version': '45je55e1za200',\n\
  \    'x-ga-page_id': 1747422523211,\n    'x-ga-gcd': '13l3l3l3l1l1',\n    'x-ga-npa':\
  \ '0',\n    'x-ga-dma': '0',\n    'x-ga-mp2-tag_exp':\n      '101509157~103116025~103130498~103130500~103136993~103136995~103200001~103207802~103211513~103233427~103252644~103252646~103263073~103301114~103301116',\n\
  \    client_id: 'AUJctU7H7hBB/aMuhE4pKwGu5DWDdklg5abyyyn8i/I=.1747154479',\n   \
  \ 'x-ga-ecid': '1294673677',\n    language: 'en-us',\n    screen_resolution: '1512x982',\n\
  \    event_location: { country: 'BR', region: 'SP' },\n    event_id: '101509157~103116025~103130498',\n\
  \    timestamp: 1748377016,\n    client_hints: {\n      architecture: 'arm',\n \
  \     bitness: '64',\n      full_version_list: [\n        { brand: 'Chromium', version:\
  \ '136.0.7103.93' },\n        { brand: 'Google Chrome', version: '136.0.7103.93'\
  \ },\n        { brand: 'Not.A/Brand', version: '99.0.0.0' }\n      ],\n      mobile:\
  \ false,\n      model: '',\n      platform: 'macOS',\n      platform_version: '15.2.0',\n\
  \      wow64: false,\n      brands: [\n        { brand: 'Chromium', version: '136'\
  \ },\n        { brand: 'Google Chrome', version: '136' },\n        { brand: 'Not.A/Brand',\
  \ version: '99' }\n      ]\n    },\n    'x-ga-are': '1',\n    'x-ga-mp2-frm': '0',\n\
  \    'x-ga-pscdl': 'noapi',\n    'x-ga-system_properties': { eu: [34], tu: 'BA',\
  \ ss: '1', ee: true },\n    'x-sst-system_properties': {\n      etld: 'google.com.br',\n\
  \      tft: '1747422523211',\n      lpc: '60493049',\n      navt: 'r',\n      ude:\
  \ '0',\n      sw_exp: '1',\n      request_start_time_ms: 1747422524851\n    },\n\
  \    'x-ga-request_count': 1,\n    ga_session_id: '1747422523',\n    ga_session_number:\
  \ 3,\n    'x-ga-mp2-seg': '0',\n    page_location: 'https://example.com/?test=1i23i21j3',\n\
  \    page_title: 'Example Domain',\n    event_name: 'page_view',\n    'x-ga-tfd':\
  \ 5784,\n    ip_override: '2804:14d:c096:8dd6:311c:8c00:e6c:e33',\n    user_agent:\n\
  \      'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML,\
  \ like Gecko) Chrome/136.0.0.0 Safari/537.36',\n    transaction_id: 'transactionId',\n\
  \    value: 123.45,\n    currency: 'BRL',\n    payment_type: 'card',\n    customer_type:\
  \ 'new', \n    user_id: 'userId',\n    user_data: {\n      email: { 0: 'userEmail',\
  \ 1: 'test2@example.net' },\n      phone_number: '+55 (19) 99999-9999'\n    },\n\
  \    coupon: 'coupon',\n    items: [\n      {\n        item_id: 'SKU_12345',\n \
  \       item_name: 'Stan and Friends Tee',\n        affiliation: 'Google Merchandise\
  \ Store',\n        coupon: 'SUMMER_FUN',\n        discount: 2.22,\n        index:\
  \ 0,\n        item_brand: 'Google',\n        item_category: 'Apparel|iajsdiajsd|oasodiasd',\n\
  \        item_list_id: 'related_products',\n        item_list_name: 'Related Products',\n\
  \        item_variant: 'green',\n        location_id: 'ChIJIQBpAG2ahYAR_6128GcTUEo',\n\
  \        price: 10.01,\n        quantity: 3,\n        item_group_id: 'abc'\n   \
  \   },\n      {\n        item_id: 'SKU_12346',\n        item_name: \"Google Grey\
  \ Women's (Tee)\",\n        affiliation: 'Google Merchandise Store',\n        coupon:\
  \ 'SUMMER_FUN',\n        discount: 3.33,\n        index: 1,\n        item_brand:\
  \ 'Google',\n        item_category: 'Apparel|iajsdiajsd|oasodiasd',\n        item_list_id:\
  \ 'related_products',\n        item_list_name: 'Related Products',\n        item_variant:\
  \ 'gray',\n        location_id: 'ChIJIQBpAG2ahYAR_6128GcTUEo',\n        price: 21.01,\n\
  \        promotion_id: 'P_12345',\n        promotion_name: 'Summer Sale',\n    \
  \    quantity: 2,\n        item_group_id: 'xyz'\n      }\n    ]\n  }, objToBeMerged\
  \ || {}));\n};\n\nconst expectedBigQuerySettings = {\n  logBigQueryProjectId: 'logBigQueryProjectId',\n\
  \  logBigQueryDatasetId: 'logBigQueryDatasetId',\n  logBigQueryTableId: 'logBigQueryTableId'\n\
  };\n\nconst requiredConsoleKeys = ['Type', 'TraceId', 'Name'];\nconst requiredBqKeys\
  \ = ['timestamp', 'type', 'trace_id', 'tag_name'];\nconst expectedBqOptions = {\
  \ ignoreUnknownValues: true };\n\nconst mockData = {\n  useOptimisticScenario: false,\n\
  \  adStorageConsent: 'optional',\n  logBigQueryProjectId: expectedBigQuerySettings.logBigQueryProjectId,\n\
  \  logBigQueryDatasetId: expectedBigQuerySettings.logBigQueryDatasetId,\n  logBigQueryTableId:\
  \ expectedBigQuerySettings.logBigQueryTableId\n};\n\nconst setAllMockDataByEventType\
  \ = (type, objToBeMerged) => {\n  const mockDataByEventType = {\n    pageView: {\n\
  \      type: 'pageView',\n      cookieDomain: 'auto',\n      cookieHttpOnly: false,\n\
  \      cookieSameSite: 'none',\n      cookieExpiration: '30'\n    },\n    conversion_sale:\
  \ { \n      type: 'conversion',\n      conversionType: 'sale',\n      autoMapData:\
  \ true,\n      effinityId: 'effinityId',\n      consentPerformance: true,\n    \
  \  orderOrLeadId: 'orderId',\n      value: 'value',\n      currency: 'currency',\n\
  \      voucher: 'voucher',\n      idCompteur: 'eff_cpt',\n      effiId: 'eff_sub1',\n\
  \      effiId2: 'eff_sub2',\n      prodId: 'eff_pid',\n      effiPcid: 'eff_pcid',\n\
  \      effiPcuid: 'eff_pcuid',\n      effiParam1: 'eff_pr1',\n      paymentType:\
  \ 'paymentype',\n      newCustomer: true,\n      cart: [\n        {\n          item_id:\
  \ 'SKU_12345',\n          item_name: 'Stan and Friends Tee',\n          price: 10.01,\n\
  \          quantity: 3\n        },\n        {\n          item_id: 'SKU_12346',\n\
  \          item_name: \"Google Grey Women's (Tee)\",\n          price: 21.01,\n\
  \          quantity: 2\n        }\n      ],\n      attribution: 2,\n      date:\
  \ '2025-12-31',\n      customFields: [{ name: 'ref2', value: '123' }],\n      adStorageConsent:\
  \ 'optional',\n      logType: 'debug',\n      bigQueryLogType: 'no'\n    },\n  \
  \  conversion_lead: {\n      type: 'conversion',\n      conversionType: 'lead',\n\
  \      autoMapData: true,\n      effinityId: 'effinityId',\n      consentPerformance:\
  \ true,\n      orderOrLeadId: 'leadId',\n      idCompteur: 'eff_cpt',\n      effiId:\
  \ 'eff_sub1',\n      effiId2: 'eff_sub2',\n      prodId: 'eff_pid',\n      effiPcid:\
  \ 'eff_pcid',\n      effiPcuid: 'eff_pcuid',\n      effiParam1: 'eff_pr1',\n   \
  \   attribution: 2,\n      date: '2025-12-31',\n      customFields: [{ name: 'ref2',\
  \ value: '123' }],\n      adStorageConsent: 'optional',\n      logType: 'debug',\n\
  \      bigQueryLogType: 'no'\n    }\n  };\n  \n  mergeObj(mockDataByEventType[type],\
  \ objToBeMerged || {});\n  mergeObj(mockData, mockDataByEventType[type]);\n  return\
  \ mockData;\n};\n\nmock('sendHttpRequest', (requestUrl, callback, requestOptions,\
  \ requestBody) => {\n  if (typeof callback === 'function') {\n    callback(200);\n\
  \  } else {\n    requestBody = requestOptions;\n    requestOptions = callback;\n\
  \    return Promise.create((resolve, reject) => {\n      resolve({ statusCode: 200\
  \ });\n    });  \n  }\n});\n\nmock('getRequestHeader', (header) => {\n  if (header\
  \ === 'trace-id') return 'expectedTraceId';\n});\n\nmock('getTimestampMillis', 1747945830456);\n\
  \nmock('generateRandom', 123456789);"


___NOTES___

Created on 7/31/2025, 6:02:27 PM


